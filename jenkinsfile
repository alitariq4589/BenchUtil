node('Runner2'){
    checkout scm
    stage ('*** Test on x86_64 ***'){
        sh'''#!/bin/bash
            echo -e "[jenkinsfile INFO]: Compiling for x86_64 architecture\n"
            make
            echo -e "[jenkinsfile INFO]: Running benchmark for Integer Operations Per Second\n"
            cat $(echo "1" | ./iops64) > x86_64_iops.log # This passes the number of processor(s) as '1' to C script.
            echo -e "[jenkinsfile INFO]: Running benchmark for Floating point Operations Per Second\n"
            cat $(echo "1"|./flops64) > x86_64_flops.log
        '''
    }
    
    stage ('*** Cleaning ***'){
        sh'''#!/bin/bash
            echo -e "[jenkinsfile INFO]: Cleaning for next benchmark...\n"
            make clean
            echo -e "[jenkinsfile INFO]: Cleaning Complete"
        '''
    }
    stage ('*** Test on riscv64 (qemu) ***'){
       sh'''#!/bin/bash
            echo -e "[jenkinsfile INFO]: Compiling for riscv_64 architecture\n"
            make CC=riscv64-unknown-linux-gnu-gcc 
            echo -e "[jenkinsfile INFO]: Running benchmark for Integer Operations Per Seconds\n"
            cat $(echo "1" | qemu-riscv64 iops64) > riscv64_iops.log
            echo -e "[jenkinfile INFO]: Running benchmark for Floating point Operations Per Seconds\n"
            cat $(echo "1" | qemu-riscv64 flops64) > riscv64_flops.log
       '''
    }
    stage ('*** Cleaning ***'){
        sh'''#!/bin/bash
            echo -e "[jenkinsfile INFO]: Cleaning...\n"
            make clean
            echo -e "[jenkinsfile INFO]: End of Job"
        '''
    }
} 
